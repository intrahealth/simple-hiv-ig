<?xml version="1.0" encoding="UTF-8"?>

<Library xmlns="http://hl7.org/fhir">
  <id value="HIVSimpleViralLoad"/>
  <text>
    <status value="generated"/><div xmlns="http://www.w3.org/1999/xhtml"><h2>Contents</h2><p><code>text/cql</code></p><pre><code class="language-sql">library HIVSimpleViralLoad version '0.1.0'

using FHIR version '4.0.1'

include FHIRHelpers version '4.0.1'
include FHIRCommon version '0.1.0' called FC
include AgeRanges version '0.1.0' called AR

// SNOMED-CT, International Edition
codesystem "SNOMED-CT": 'http://snomed.info/sct' version 'http://snomed.info/sct/900000000000207008'

// LOINC, 2.63+
codesystem "LOINC": 'http://loinc.org'

// Viral load
// * LOINC code 25836-8
// * "HIV 1 RNA NAA+probe (Specimen)"
// * Units: copies/mL
// * Suppressed viral load (&lt;1000 copies/mL)
// * Used range of 200 (very low) -&gt; 1000000 (very high)
code "HIV 1 RNA NAA+probe (Specimen)": '25836-8' from "LOINC" display 'HIV 1 RNA NAA+probe (Specimen)'

context Patient

// all these seem to workie

define "Suppressed":
  [Observation: "HIV 1 RNA NAA+probe (Specimen)"] Observation
    where Observation.value &lt; 1000 'copies/mL'

define "Unsuppressed":
  [Observation: "HIV 1 RNA NAA+probe (Specimen)"] Observation
    where Observation.value &gt;= 1000 'copies/mL'

define "Viral Load Test Result":
  ["Observation": "HIV 1 RNA NAA+probe (Specimen)"] Observation
    where Observation.value is not null

// below works
define "Living with HIV and on ART with suppressed viral load results (&lt;1000 copies/mL)":
  ["Observation": "HIV 1 RNA NAA+probe (Specimen)"] Observation
    where Observation.value &lt; 1000 'copies/mL'

define "Living with HIV and on ART with unsuppressed viral load results (&gt;1000 copies/mL)":
  ["Observation": "HIV 1 RNA NAA+probe (Specimen)"] Observation
    where Observation.value &gt;= 1000 'copies/mL'

define "Sex": Patient.gender

define "Initial Population": true

define "Denominator": true

define "Numerator":
  "Unsuppressed"
</code></pre><p><code>No Content</code> (<code>application/elm+xml</code>)</p></div>
  </text>
  <url value="https://github.com/intrahealth/simple-hiv-ig/Library/HIVSimpleViralLoad"/>
  <version value="0.1.0"/>
  <name value="HIVSimpleViralLoad"/>
  <title value="HIVSimpleViralLoad"/>
  <status value="active"/>
  <experimental value="true"/>
  <type>
    <coding>
      <system value="http://terminology.hl7.org/CodeSystem/library-type"/>
      <code value="logic-library"/>
    </coding>
  </type>
  <date value="2021-06-29T01:02:10+00:00"/>
  <publisher value="IntraHealth International"/>
  <contact>
    <telecom>
      <system value="url"/>
      <value value="http://hl7.org/Special/committees/[something]"/>
    </telecom>
  </contact>
  <content>
    <contentType value="text/cql"/>
    <data value="bGlicmFyeSBISVZTaW1wbGVWaXJhbExvYWQgdmVyc2lvbiAnMC4xLjAnCgp1c2luZyBGSElSIHZlcnNpb24gJzQuMC4xJwoKaW5jbHVkZSBGSElSSGVscGVycyB2ZXJzaW9uICc0LjAuMScKaW5jbHVkZSBGSElSQ29tbW9uIHZlcnNpb24gJzAuMS4wJyBjYWxsZWQgRkMKaW5jbHVkZSBBZ2VSYW5nZXMgdmVyc2lvbiAnMC4xLjAnIGNhbGxlZCBBUgoKLy8gU05PTUVELUNULCBJbnRlcm5hdGlvbmFsIEVkaXRpb24KY29kZXN5c3RlbSAiU05PTUVELUNUIjogJ2h0dHA6Ly9zbm9tZWQuaW5mby9zY3QnIHZlcnNpb24gJ2h0dHA6Ly9zbm9tZWQuaW5mby9zY3QvOTAwMDAwMDAwMDAwMjA3MDA4JwoKLy8gTE9JTkMsIDIuNjMrCmNvZGVzeXN0ZW0gIkxPSU5DIjogJ2h0dHA6Ly9sb2luYy5vcmcnCgovLyBWaXJhbCBsb2FkCi8vICogTE9JTkMgY29kZSAyNTgzNi04Ci8vICogIkhJViAxIFJOQSBOQUErcHJvYmUgKFNwZWNpbWVuKSIKLy8gKiBVbml0czogY29waWVzL21MCi8vICogU3VwcHJlc3NlZCB2aXJhbCBsb2FkICg8MTAwMCBjb3BpZXMvbUwpCi8vICogVXNlZCByYW5nZSBvZiAyMDAgKHZlcnkgbG93KSAtPiAxMDAwMDAwICh2ZXJ5IGhpZ2gpCmNvZGUgIkhJViAxIFJOQSBOQUErcHJvYmUgKFNwZWNpbWVuKSI6ICcyNTgzNi04JyBmcm9tICJMT0lOQyIgZGlzcGxheSAnSElWIDEgUk5BIE5BQStwcm9iZSAoU3BlY2ltZW4pJwoKY29udGV4dCBQYXRpZW50CgovLyBhbGwgdGhlc2Ugc2VlbSB0byB3b3JraWUKCmRlZmluZSAiU3VwcHJlc3NlZCI6CiAgW09ic2VydmF0aW9uOiAiSElWIDEgUk5BIE5BQStwcm9iZSAoU3BlY2ltZW4pIl0gT2JzZXJ2YXRpb24KICAgIHdoZXJlIE9ic2VydmF0aW9uLnZhbHVlIDwgMTAwMCAnY29waWVzL21MJwoKZGVmaW5lICJVbnN1cHByZXNzZWQiOgogIFtPYnNlcnZhdGlvbjogIkhJViAxIFJOQSBOQUErcHJvYmUgKFNwZWNpbWVuKSJdIE9ic2VydmF0aW9uCiAgICB3aGVyZSBPYnNlcnZhdGlvbi52YWx1ZSA+PSAxMDAwICdjb3BpZXMvbUwnCgpkZWZpbmUgIlZpcmFsIExvYWQgVGVzdCBSZXN1bHQiOgogIFsiT2JzZXJ2YXRpb24iOiAiSElWIDEgUk5BIE5BQStwcm9iZSAoU3BlY2ltZW4pIl0gT2JzZXJ2YXRpb24KICAgIHdoZXJlIE9ic2VydmF0aW9uLnZhbHVlIGlzIG5vdCBudWxsCgovLyBiZWxvdyB3b3JrcwpkZWZpbmUgIkxpdmluZyB3aXRoIEhJViBhbmQgb24gQVJUIHdpdGggc3VwcHJlc3NlZCB2aXJhbCBsb2FkIHJlc3VsdHMgKDwxMDAwIGNvcGllcy9tTCkiOgogIFsiT2JzZXJ2YXRpb24iOiAiSElWIDEgUk5BIE5BQStwcm9iZSAoU3BlY2ltZW4pIl0gT2JzZXJ2YXRpb24KICAgIHdoZXJlIE9ic2VydmF0aW9uLnZhbHVlIDwgMTAwMCAnY29waWVzL21MJwoKZGVmaW5lICJMaXZpbmcgd2l0aCBISVYgYW5kIG9uIEFSVCB3aXRoIHVuc3VwcHJlc3NlZCB2aXJhbCBsb2FkIHJlc3VsdHMgKD4xMDAwIGNvcGllcy9tTCkiOgogIFsiT2JzZXJ2YXRpb24iOiAiSElWIDEgUk5BIE5BQStwcm9iZSAoU3BlY2ltZW4pIl0gT2JzZXJ2YXRpb24KICAgIHdoZXJlIE9ic2VydmF0aW9uLnZhbHVlID49IDEwMDAgJ2NvcGllcy9tTCcKCmRlZmluZSAiU2V4IjogUGF0aWVudC5nZW5kZXIKCmRlZmluZSAiSW5pdGlhbCBQb3B1bGF0aW9uIjogdHJ1ZQoKZGVmaW5lICJEZW5vbWluYXRvciI6IHRydWUKCmRlZmluZSAiTnVtZXJhdG9yIjoKICAiVW5zdXBwcmVzc2VkIgo="/>
  </content>
  <content>
    <contentType value="application/elm+xml"/>
  </content>
</Library>