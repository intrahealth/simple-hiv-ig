<?xml version="1.0" encoding="UTF-8"?>

<Library xmlns="http://hl7.org/fhir">
  <id value="HIVSimpleTestResult"/>
  <text>
    <status value="generated"/><div xmlns="http://www.w3.org/1999/xhtml"><h2>Contents</h2><p><code>text/cql</code></p><pre><code class="language-sql">library HIVSimpleTestResult version '0.1.0'

using FHIR version '4.0.1'

include FHIRHelpers version '4.0.1'
include FHIRCommon version '0.1.0' called FC
include AgeRanges version '0.1.0' called AR

// SNOMED-CT, International Edition
codesystem "SNOMED-CT": 'http://snomed.info/sct' version 'http://snomed.info/sct/900000000000207008'

// LOINC, 2.63+
codesystem "LOINC": 'http://loinc.org'

// HIV Test Results
code "HIV Negative": '165815009' from "SNOMED-CT" display 'HIV Negative'
code "HIV Positive": '165816005' from "SNOMED-CT" display 'HIV Positive'
code "HIV 1 and 2 tests - Meaningful Use set": '75622-1' from "LOINC" display 'HIV 1 and 2 tests - Meaningful Use set'

context Patient

define "HIV Test Exists":
  exists ([Observation: "HIV 1 and 2 tests - Meaningful Use set"])

define "HIV Positive Observation":
  [Observation: "HIV 1 and 2 tests - Meaningful Use set"] Observation
    where Observation.value = "HIV Positive"

define "HIV Negative Observation":
  [Observation: "HIV 1 and 2 tests - Meaningful Use set"] Observation
    where Observation.value = "HIV Negative"

define "Is HIV Positive":
  exists ("HIV Positive Observation")
  and "HIV Test Exists"

define "Is HIV Negative":
  exists ("HIV Negative Observation")
  and "HIV Test Exists"

// always null
define "HIV Test Results":
  case
    when "Is HIV Positive" then "HIV Positive"
    when "Is HIV Negative" then "HIV Negative"
    else null
  end

define "Sex": Patient.gender

// Age Group/Sex
// always null
define "Age Group/Sex": AR."Age Group".code + ':' + "Sex"

// always null
define "Age Group/Sex/HIV Test Results":
  AR."Age Group".code + ':' + "Sex" + ':' + "HIV Test Results".code

define "Initial Population": true

define "Denominator": true

define "Numerator":
  "Is HIV Negative"
  and "Sex" = 'female'
</code></pre><p><code>No Content</code> (<code>application/elm+xml</code>)</p></div>
  </text>
  <url value="https://github.com/intrahealth/simple-hiv-ig/Library/HIVSimpleTestResult"/>
  <version value="0.1.0"/>
  <name value="HIVSimpleTestResult"/>
  <title value="HIVSimpleTestResult"/>
  <status value="active"/>
  <experimental value="true"/>
  <type>
    <coding>
      <system value="http://terminology.hl7.org/CodeSystem/library-type"/>
      <code value="logic-library"/>
    </coding>
  </type>
  <date value="2021-06-29T00:55:49+00:00"/>
  <publisher value="IntraHealth International"/>
  <contact>
    <telecom>
      <system value="url"/>
      <value value="http://hl7.org/Special/committees/[something]"/>
    </telecom>
  </contact>
  <content>
    <contentType value="text/cql"/>
    <data value="bGlicmFyeSBISVZTaW1wbGVUZXN0UmVzdWx0IHZlcnNpb24gJzAuMS4wJwoKdXNpbmcgRkhJUiB2ZXJzaW9uICc0LjAuMScKCmluY2x1ZGUgRkhJUkhlbHBlcnMgdmVyc2lvbiAnNC4wLjEnCmluY2x1ZGUgRkhJUkNvbW1vbiB2ZXJzaW9uICcwLjEuMCcgY2FsbGVkIEZDCmluY2x1ZGUgQWdlUmFuZ2VzIHZlcnNpb24gJzAuMS4wJyBjYWxsZWQgQVIKCi8vIFNOT01FRC1DVCwgSW50ZXJuYXRpb25hbCBFZGl0aW9uCmNvZGVzeXN0ZW0gIlNOT01FRC1DVCI6ICdodHRwOi8vc25vbWVkLmluZm8vc2N0JyB2ZXJzaW9uICdodHRwOi8vc25vbWVkLmluZm8vc2N0LzkwMDAwMDAwMDAwMDIwNzAwOCcKCi8vIExPSU5DLCAyLjYzKwpjb2Rlc3lzdGVtICJMT0lOQyI6ICdodHRwOi8vbG9pbmMub3JnJwoKLy8gSElWIFRlc3QgUmVzdWx0cwpjb2RlICJISVYgTmVnYXRpdmUiOiAnMTY1ODE1MDA5JyBmcm9tICJTTk9NRUQtQ1QiIGRpc3BsYXkgJ0hJViBOZWdhdGl2ZScKY29kZSAiSElWIFBvc2l0aXZlIjogJzE2NTgxNjAwNScgZnJvbSAiU05PTUVELUNUIiBkaXNwbGF5ICdISVYgUG9zaXRpdmUnCmNvZGUgIkhJViAxIGFuZCAyIHRlc3RzIC0gTWVhbmluZ2Z1bCBVc2Ugc2V0IjogJzc1NjIyLTEnIGZyb20gIkxPSU5DIiBkaXNwbGF5ICdISVYgMSBhbmQgMiB0ZXN0cyAtIE1lYW5pbmdmdWwgVXNlIHNldCcKCmNvbnRleHQgUGF0aWVudAoKZGVmaW5lICJISVYgVGVzdCBFeGlzdHMiOgogIGV4aXN0cyAoW09ic2VydmF0aW9uOiAiSElWIDEgYW5kIDIgdGVzdHMgLSBNZWFuaW5nZnVsIFVzZSBzZXQiXSkKCmRlZmluZSAiSElWIFBvc2l0aXZlIE9ic2VydmF0aW9uIjoKICBbT2JzZXJ2YXRpb246ICJISVYgMSBhbmQgMiB0ZXN0cyAtIE1lYW5pbmdmdWwgVXNlIHNldCJdIE9ic2VydmF0aW9uCiAgICB3aGVyZSBPYnNlcnZhdGlvbi52YWx1ZSA9ICJISVYgUG9zaXRpdmUiCgpkZWZpbmUgIkhJViBOZWdhdGl2ZSBPYnNlcnZhdGlvbiI6CiAgW09ic2VydmF0aW9uOiAiSElWIDEgYW5kIDIgdGVzdHMgLSBNZWFuaW5nZnVsIFVzZSBzZXQiXSBPYnNlcnZhdGlvbgogICAgd2hlcmUgT2JzZXJ2YXRpb24udmFsdWUgPSAiSElWIE5lZ2F0aXZlIgoKZGVmaW5lICJJcyBISVYgUG9zaXRpdmUiOgogIGV4aXN0cyAoIkhJViBQb3NpdGl2ZSBPYnNlcnZhdGlvbiIpCiAgYW5kICJISVYgVGVzdCBFeGlzdHMiCgpkZWZpbmUgIklzIEhJViBOZWdhdGl2ZSI6CiAgZXhpc3RzICgiSElWIE5lZ2F0aXZlIE9ic2VydmF0aW9uIikKICBhbmQgIkhJViBUZXN0IEV4aXN0cyIKCi8vIGFsd2F5cyBudWxsCmRlZmluZSAiSElWIFRlc3QgUmVzdWx0cyI6CiAgY2FzZQogICAgd2hlbiAiSXMgSElWIFBvc2l0aXZlIiB0aGVuICJISVYgUG9zaXRpdmUiCiAgICB3aGVuICJJcyBISVYgTmVnYXRpdmUiIHRoZW4gIkhJViBOZWdhdGl2ZSIKICAgIGVsc2UgbnVsbAogIGVuZAoKZGVmaW5lICJTZXgiOiBQYXRpZW50LmdlbmRlcgoKLy8gQWdlIEdyb3VwL1NleAovLyBhbHdheXMgbnVsbApkZWZpbmUgIkFnZSBHcm91cC9TZXgiOiBBUi4iQWdlIEdyb3VwIi5jb2RlICsgJzonICsgIlNleCIKCi8vIGFsd2F5cyBudWxsCmRlZmluZSAiQWdlIEdyb3VwL1NleC9ISVYgVGVzdCBSZXN1bHRzIjoKICBBUi4iQWdlIEdyb3VwIi5jb2RlICsgJzonICsgIlNleCIgKyAnOicgKyAiSElWIFRlc3QgUmVzdWx0cyIuY29kZQoKZGVmaW5lICJJbml0aWFsIFBvcHVsYXRpb24iOiB0cnVlCgpkZWZpbmUgIkRlbm9taW5hdG9yIjogdHJ1ZQoKZGVmaW5lICJOdW1lcmF0b3IiOgogICJJcyBISVYgTmVnYXRpdmUiCiAgYW5kICJTZXgiID0gJ2ZlbWFsZScK"/>
  </content>
  <content>
    <contentType value="application/elm+xml"/>
  </content>
</Library>